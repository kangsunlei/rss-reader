
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>通过 PGO 自动化 Go 程序的效率提升</title>
        <style>
            body {
                padding: 12px;
                margin: 0;
                line-height: 1.8;
            }
            img { max-width: 100%; }
        </style>
    </head>
    <body>
        <h2>通过 PGO 自动化 Go 程序的效率提升</h2>
        <p>3/13/2025, 1:00:00 PM</p>
        <p><div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; max-width: 100%; margin: 0px auto; color: rgb(30, 41, 59); padding: 20px 0px;">
        <div style="margin: 30px 0px; padding: 20px; background-color: rgb(255, 255, 255); border-radius: 8px; border-left: 4px solid #2563eb;">
            <h3 style="color: rgb(30, 64, 175); margin: 0px 0px 12px 0px; font-size: 1.2em; display: flex; align-items: center;">
                <span style="color: #2563eb; margin-right: 8px">📌</span> 一句话摘要
            </h3>
            <p style="margin: 0; line-height: 1.8; color: #334155">Uber 通过自动化 PGO 流程优化 Go 程序，提升性能并降低资源利用率。</p>
        </div>
<div style="margin: 30px 0px; padding: 20px; background-color: rgb(255, 255, 255); border-radius: 8px; border-left: 4px solid #2563eb;">
            <h3 style="color: rgb(30, 64, 175); margin: 0px 0px 12px 0px; font-size: 1.2em; display: flex; align-items: center;">
                <span style="color: #2563eb; margin-right: 8px">📝</span> 详细摘要
            </h3>
            <p style="margin: 0; line-height: 1.8; color: #334155">本文介绍了 Uber 如何通过 Profile-Guided Optimization (PGO) 持续优化框架来提升 Go 程序的效率，解决 CPU 利用率高和编译时间长的问题。文章详细阐述了 PGO 的原理，包括 Profiling（性能剖析）， Analysis（分析）， 和 Recompilation（重新编译）三个阶段，并分享了 Uber 在生产环境中部署 PGO 的实践经验，包括每日性能剖析数据收集、服务注册、CI 测试、部署和性能监控。此外，文章还介绍了 Uber 如何通过开发性能剖析数据预处理工具 (构建和使用 call graph) 来解决 PGO 引入的编译时间增加问题。通过在合成基准测试和真实 Uber 服务上的评估，验证了 PGO 在提升性能和降低资源利用率方面的有效性，尤其是在函数内联优化方面表现突出。Uber 通过 PGO 在核心服务中实现了约 4% 的性能提升，并减少了 24，000 个 CPU 核心的资源占用。PGO 在诸如 go-json 和 Tally 等服务上效果显著。</p>
        </div>
<div style="margin: 30px 0px; padding: 20px; background-color: rgb(255, 255, 255); border-radius: 8px; border-left: 4px solid #2563eb;">
            <h3 style="color: rgb(30, 64, 175); margin: 0px 0px 12px 0px; font-size: 1.2em; display: flex; align-items: center;">
                <span style="color: #2563eb; margin-right: 8px">💡</span> 主要观点
            </h3>
            <ol style="margin: 0; padding-left: 20px; color: #334155">
                <li style="margin: 12px 0; line-height: 1.8;">
                        <strong style="color: #1e40af">PGO 通过运行时数据指导函数内联优化，提升软件性能</strong>
                        <span style="color: #64748b; display: block; margin-top: 6px; padding-left: 20px; border-left: 2px solid #e2e8f0"> PGO 利用程序运行时的 profile 数据，指导编译器进行函数内联优化，减少函数调用开销，从而生成更高效的机器码。</span>
                    </li><li style="margin: 12px 0; line-height: 1.8;">
                        <strong style="color: #1e40af">PGO 通过运行时数据指导代码布局优化，提升软件性能</strong>
                        <span style="color: #64748b; display: block; margin-top: 6px; padding-left: 20px; border-left: 2px solid #e2e8f0"> PGO 利用程序运行时的 profile 数据，指导编译器进行代码布局优化，提高代码局部性（空间局部性），减少指令缓存和 TLB 失效（TLB miss）。</span>
                    </li><li style="margin: 12px 0; line-height: 1.8;">
                        <strong style="color: #1e40af">Uber 的持续优化框架简化了 PGO 的部署和管理</strong>
                        <span style="color: #64748b; display: block; margin-top: 6px; padding-left: 20px; border-left: 2px solid #e2e8f0"> 通过自动化的 profile 数据收集、预处理和部署流程，Uber 实现了 PGO 在生产环境中的持续优化，降低了人工干预成本。</span>
                    </li><li style="margin: 12px 0; line-height: 1.8;">
                        <strong style="color: #1e40af">Profile 预处理工具显著减少了 PGO 带来的编译时间增加</strong>
                        <span style="color: #64748b; display: block; margin-top: 6px; padding-left: 20px; border-left: 2px solid #e2e8f0"> 通过离线预处理 profile 数据，避免了编译期间重复解析 pprof 文件，大幅缩短了 PGO 编译时间。</span>
                    </li><li style="margin: 12px 0; line-height: 1.8;">
                        <strong style="color: #1e40af">PGO 有助于解决大型 Go 二进制文件的性能问题</strong>
                        <span style="color: #64748b; display: block; margin-top: 6px; padding-left: 20px; border-left: 2px solid #e2e8f0"> 通过优化代码布局，PGO 能够减少大型 Go 二进制文件中的指令缓存和 TLB 失效（TLB miss），从而提升性能。</span>
                    </li>
            </ol>
        </div>
<div style="margin: 30px 0px; padding: 20px; background-color: rgb(255, 255, 255); border-radius: 8px; border-left: 4px solid #2563eb;">
            <h3 style="color: rgb(30, 64, 175); margin: 0px 0px 12px 0px; font-size: 1.2em; display: flex; align-items: center;">
                <span style="color: #2563eb; margin-right: 8px">💬</span> 文章金句
            </h3>
            <ul style="margin: 0; padding-left: 20px; list-style-type: none; color: #334155">
                <li style="margin: 12px 0; padding-left: 20px; border-left: 2px solid #e2e8f0; font-style: italic; line-height: 1.8;">Profile-guided optimizations can significantly enhance software performance by using runtime data to guide compiler optimizations. （Profile-guided 优化可以通过使用运行时数据指导编译器优化，从而显著提高软件性能。）</li><li style="margin: 12px 0; padding-left: 20px; border-left: 2px solid #e2e8f0; font-style: italic; line-height: 1.8;">At Uber， PGO led to a ~4% performance gain through inlining optimizations and a reduction of 24，000 CPU cores across top services. （在 Uber，PGO 通过内联优化带来了约 4% 的性能提升，并减少了顶级服务中 24，000 个 CPU 核心的使用。）</li><li style="margin: 12px 0; padding-left: 20px; border-left: 2px solid #e2e8f0; font-style: italic; line-height: 1.8;">Measuring PGO's impact can be complex， but this analysis demonstrates its value in optimizing resource utilization and achieving substantial performance improvements. （衡量 PGO 的影响可能很复杂，但这项分析证明了它在优化资源利用率和实现显著性能改进方面的价值。）</li>
            </ul>
        </div>
<div style="margin: 30px 0px; padding: 20px; background-color: rgb(255, 255, 255); border-radius: 8px; border-left: 4px solid #2563eb;">
            <h3 style="color: rgb(30, 64, 175); margin: 0px 0px 12px 0px; font-size: 1.2em; display: flex; align-items: center;">
                <span style="color: #2563eb; margin-right: 8px">📊</span> 文章信息
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; background-color: rgb(255, 255, 255);">
                <div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">AI 评分：</span><span style="color: #334155; font-weight: 500">87</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">来源：</span><span style="color: #334155; font-weight: 500">Uber Engineering Blog</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">作者：</span><span style="color: #334155; font-weight: 500">Chris Zhang</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">分类：</span><span style="color: #334155; font-weight: 500">软件编程</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">语言：</span><span style="color: #334155; font-weight: 500">英文</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">阅读时间：</span><span style="color: #334155; font-weight: 500">9 分钟</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">字数：</span><span style="color: #334155; font-weight: 500">2163</span></div>
            </div>
            
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0; background-color: rgb(255, 255, 255);">
                    <span style="color: #64748b; font-size: 14px;">标签：</span>
                    <span style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                        <span style="background-color: #15803d; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 12px;">性能优化</span>, <span style="background-color: #15803d; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 12px;">性能分析</span>, <span style="background-color: #15803d; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 12px;">Go</span>, <span style="background-color: #15803d; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 12px;">Profile-Guided Optimization</span>, <span style="background-color: #15803d; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 12px;">PGO</span>
                    </span>
                </div>
            
        </div>
    </div></p>
        <a href="https://www.bestblogs.dev/zh/article/c40742">阅读原文</a>
        <img width="400px" style="margin-left: -40px; display: block" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJQAAACUCAYAAAB1PADUAAAAAklEQVR4AewaftIAAATfSURBVO3BQY4bSRAEwfAC//9l3znmqYBGJ2clIczwR6qWnFQtOqladFK16KRq0UnVopOqRSdVi06qFp1ULTqpWnRSteikatFJ1aKTqkUnVYs+eQnIb1LzBpBJzQ2QSc0E5Ak1TwD5TWreOKladFK16KRq0SfL1GwCcgNkUjMBeQLIG2q+Sc0mIJtOqhadVC06qVr0yZcBeULNG0AmNROQCcikZgIyAXkCyBNqngDyhJpvOqladFK16KRq0Sf/OCCTmhsgk5obIBOQSc0E5F92UrXopGrRSdWiT/5yaiYgk5obIJOaN9RMQG7U/EtOqhadVC06qVr0yZep+T8BmdTcAJnU3Ki5UXMDZFLzhJo/yUnVopOqRSdViz5ZBuQ3AZnUTECeUDMBmdRMQCY1E5BJzRtA/mQnVYtOqhadVC365CU1fxIgN0AmNd+kZgIyqblR8zc5qVp0UrXopGrRJy8BmdRsAjKp+U1qbtRMQCY1k5oJyBNqboA8oWbTSdWik6pFJ1WLPvkyIJOaJ9S8oeYGyKTmBsikZlJzA2RS8wSQGzUTkN90UrXopGrRSdUi/JFFQCY1E5A31ExAJjUTkCfU3AB5Qs0NkBs1f5OTqkUnVYtOqhZ98mVAJjU3QCY1N2omIE+oeUPNDZAn1ExAbtRMQCY1v+mkatFJ1aKTqkWfvATkRs0EZFIzqZmATGomIDdqJiATkDeATGr+T2qeADKpeeOkatFJ1aKTqkWfvKRmAnKj5gk1E5BJzQRkAjKpeQLIE0C+Sc0EZFJzA+SbTqoWnVQtOqla9MmXAZnUTEAmNROQSc0E5AkgN2o2qbkBcqNmAjKpmYDcqPmmk6pFJ1WLTqoW4Y+8AGRSMwG5UfMEkBs1E5BJzQ2QSc0NkEnNDZBJzQTkDTUTkEnNBGRS88ZJ1aKTqkUnVYvwR34RkG9SMwG5UbMJyKRmAjKpeQLIpGYCcqPmm06qFp1ULTqpWvTJS0AmNROQSc0EZFLzBJAn1ExAJjUTkG8C8gaQSc0EZAJyo+aNk6pFJ1WLTqoWfbIMyBNqJiA3am6ATGomIE+omYDcqJmAbFJzA2RScwNk00nVopOqRSdViz5ZpuYGyKRmUrMJyKRmAnIDZFIzAXlCzQTkCSA3ap5Qs+mkatFJ1aKTqkWf/DI1E5An1LwB5A0gN0AmNROQ3wTkCTVvnFQtOqladFK1CH/kLwbkDTVPAJnUTEBu1ExAJjVPALlR85tOqhadVC06qVr0yUtAfpOaSc0E5EbNE0CeUDMBmYA8AWRS8wSQSc03nVQtOqladFK16JNlajYBeULNBOQNNROQ36TmCTVPAJnUvHFSteikatFJ1aJPvgzIE2reADKpuQHyJwHyBpBJzW86qVp0UrXopGrRJ/84IJOaSc0TQCYgT6iZgNyomYBMaiYgE5BJzTedVC06qVp0UrXok3+cmgnIpOYGyBtqbtTcALkB8gSQSc2mk6pFJ1WLTqoWffJlav5PQJ4AMqm5ATKpeQPIE2omIDdqJiCTmjdOqhadVC06qVr0yTIgvwnIpGYCMql5AsiNmgnIpGYCMqm5UTMBmYC8oWbTSdWik6pFJ1WL8EeqlpxULTqpWnRSteikatFJ1aKTqkUnVYtOqhadVC06qVp0UrXopGrRSdWik6pFJ1WL/gM44i9hL+kz5gAAAABJRU5ErkJggg==" alt="QR Code" />
        <a href="index.html#?category=1">返回目录</a>
    </body>
    <script>
        document.body.style.fontSize = Math.max(window.document.body.clientWidth / 30, 14) + 'px';
    </script>
    </html>