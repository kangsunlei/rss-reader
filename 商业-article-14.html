
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>100 行纯 JAX 代码，完美复现 Llama 3！</title>
        <style>
            body {
                padding: 12px;
                margin: 0;
                line-height: 1.8;
            }
            img { max-width: 100%; }
        </style>
    </head>
    <body>
        <h2>100 行纯 JAX 代码，完美复现 Llama 3！</h2>
        <p>2/24/2025, 4:56:36 AM</p>
        <p><div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; max-width: 100%; margin: 0px auto; color: rgb(30, 41, 59); padding: 20px 0px;">
        <div style="margin: 30px 0px; padding: 20px; background-color: rgb(255, 255, 255); border-radius: 8px; border-left: 4px solid #2563eb;">
            <h3 style="color: rgb(30, 64, 175); margin: 0px 0px 12px 0px; font-size: 1.2em; display: flex; align-items: center;">
                <span style="color: #2563eb; margin-right: 8px">📌</span> 一句话摘要
            </h3>
            <p style="margin: 0; line-height: 1.8; color: #334155">本文介绍如何使用 100 行纯 JAX 代码复现 Llama 3 模型的核心组件。</p>
        </div>
<div style="margin: 30px 0px; padding: 20px; background-color: rgb(255, 255, 255); border-radius: 8px; border-left: 4px solid #2563eb;">
            <h3 style="color: rgb(30, 64, 175); margin: 0px 0px 12px 0px; font-size: 1.2em; display: flex; align-items: center;">
                <span style="color: #2563eb; margin-right: 8px">📝</span> 详细摘要
            </h3>
            <p style="margin: 0; line-height: 1.8; color: #334155">本文详细介绍了如何使用纯 JAX 从零开始复现 Llama 3 模型。文章强调了选择 JAX 的原因，包括其高性能计算能力和函数式编程理念，以及 XLA、JIT、vmap、pmap 等特性带来的训练速度提升。文章逐步讲解了模型配置、权重初始化（包括注意力机制、前馈网络和 Transformer Block 的初始化）、标记化（使用 OpenAI 的 tiktoken 库）、嵌入（embeddings）、RMS 归一化、旋转位置编码（ROPE，通过旋转 Query 和 Key 向量，让模型感知位置信息）以及分组查询注意力（GQA，通过多个查询头共享 Key 和 Value 来提高计算效率）等关键步骤。此外，文章还介绍了 KV 缓存用于提高推理效率，并提供了前馈网络、Transformer Block 和前向传播的实现细节，展示了 JAX 在模型开发中的高效性和简洁性，为读者提供了一个完整的 Llama 3 模型复现指南。</p>
        </div>
<div style="margin: 30px 0px; padding: 20px; background-color: rgb(255, 255, 255); border-radius: 8px; border-left: 4px solid #2563eb;">
            <h3 style="color: rgb(30, 64, 175); margin: 0px 0px 12px 0px; font-size: 1.2em; display: flex; align-items: center;">
                <span style="color: #2563eb; margin-right: 8px">💡</span> 主要观点
            </h3>
            <ol style="margin: 0; padding-left: 20px; color: #334155">
                <li style="margin: 12px 0; line-height: 1.8;">
                        <strong style="color: #1e40af">使用纯 JAX 实现 Llama 3，展示了 JAX 在模型开发中的高效性和简洁性</strong>
                        <span style="color: #64748b; display: block; margin-top: 6px; padding-left: 20px; border-left: 2px solid #e2e8f0"> JAX 的函数式编程范式和自动微分功能，使得模型实现更加清晰，方便并行化和优化。</span>
                    </li><li style="margin: 12px 0; line-height: 1.8;">
                        <strong style="color: #1e40af">ROPE 旋转位置编码让模型能自然地感知 token 顺序</strong>
                        <span style="color: #64748b; display: block; margin-top: 6px; padding-left: 20px; border-left: 2px solid #e2e8f0"> ROPE 通过对 Query 和 Key 向量进行旋转变换，将位置信息编码到 token 特征中，无需额外的位置向量。</span>
                    </li><li style="margin: 12px 0; line-height: 1.8;">
                        <strong style="color: #1e40af">GQA 分组查询注意力机制提高计算效率</strong>
                        <span style="color: #64748b; display: block; margin-top: 6px; padding-left: 20px; border-left: 2px solid #e2e8f0"> GQA 通过让多个查询头共享键和值，减少计算量和内存占用，加快大模型推理速度。</span>
                    </li>
            </ol>
        </div>
<div style="margin: 30px 0px; padding: 20px; background-color: rgb(255, 255, 255); border-radius: 8px; border-left: 4px solid #2563eb;">
            <h3 style="color: rgb(30, 64, 175); margin: 0px 0px 12px 0px; font-size: 1.2em; display: flex; align-items: center;">
                <span style="color: #2563eb; margin-right: 8px">💬</span> 文章金句
            </h3>
            <ul style="margin: 0; padding-left: 20px; list-style-type: none; color: #334155">
                <li style="margin: 12px 0; padding-left: 20px; border-left: 2px solid #e2e8f0; font-style: italic; line-height: 1.8;">在这篇文章中，我们将使用纯 JAX 从零实现 Llama3，只需 100 行代码。</li><li style="margin: 12px 0; padding-left: 20px; border-left: 2px solid #e2e8f0; font-style: italic; line-height: 1.8;">LLaMA 3 本质上是一个仅包含解码器的 Transformer 语言模型，它通过逐个生成 token 来预测下一个内容，就像一句话逐词补全的过程。</li><li style="margin: 12px 0; padding-left: 20px; border-left: 2px solid #e2e8f0; font-style: italic; line-height: 1.8;">vmap 就像是一个向量化的循环，它接收一个处理单个索引的函数（用 lax.dynamic_slice 提取一系列 tokens），然后将这个函数应用到数组中的每一个元素。这样，我们的输入序列（x）和对应的目标序列（y，目标序列是通过将原始序列右移一个 token 来实现下一个词预测）就能一次性创建出来。</li>
            </ul>
        </div>
<div style="margin: 30px 0px; padding: 20px; background-color: rgb(255, 255, 255); border-radius: 8px; border-left: 4px solid #2563eb;">
            <h3 style="color: rgb(30, 64, 175); margin: 0px 0px 12px 0px; font-size: 1.2em; display: flex; align-items: center;">
                <span style="color: #2563eb; margin-right: 8px">📊</span> 文章信息
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; background-color: rgb(255, 255, 255);">
                <div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">AI 评分：</span><span style="color: #334155; font-weight: 500">84</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">来源：</span><span style="color: #334155; font-weight: 500">CSDN</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">作者：</span><span style="color: #334155; font-weight: 500">CSDN</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">分类：</span><span style="color: #334155; font-weight: 500">商业科技</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">语言：</span><span style="color: #334155; font-weight: 500">中文</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">阅读时间：</span><span style="color: #334155; font-weight: 500">23 分钟</span></div>
<div style="padding: 10px; background: white; border-radius: 6px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); background-color: rgb(255, 255, 255);"><span style="color: #64748b; font-size: 14px; margin-right: 8px">字数：</span><span style="color: #334155; font-weight: 500">5575</span></div>
            </div>
            
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0; background-color: rgb(255, 255, 255);">
                    <span style="color: #64748b; font-size: 14px;">标签：</span>
                    <span style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                        <span style="background-color: #15803d; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 12px;">大语言模型</span>, <span style="background-color: #15803d; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 12px;">Llama 3</span>, <span style="background-color: #15803d; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 12px;">JAX</span>, <span style="background-color: #15803d; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 12px;">模型复现</span>, <span style="background-color: #15803d; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 12px;">Transformer</span>
                    </span>
                </div>
            
        </div>
    </div></p>
        <a href="https://www.bestblogs.dev/zh/article/64b94d">阅读原文</a>
        <img width="400px" style="margin-left: -40px; display: block" src="data:image/png;base64,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" alt="QR Code" />
        <a href="index.html">返回目录</a>
    </body>
    <script>
        document.body.style.fontSize = Math.max(window.document.body.clientWidth / 30, 14) + 'px';
    </script>
    </html>